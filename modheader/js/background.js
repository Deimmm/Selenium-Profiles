import { P as Pe$1, w as we$1, a as wr, O as Oe$1, C as Ce$1, l as le$1, _ as _r, m as mr, j as jr } from '../csp-68c86558.js';
import { d as dl, S as Sv, j as jv, i as ib, c as cb, u as ub, O as Ob, b as bb, J as Jf, E as Eo, s as sb, f as fb } from '../profile-hook-3f857096.js';
import { r as rn, U as Ut, o as on, t as tn, n as nn, Q as Qt, W as Wt, e as en, Y as Yt, X as Xt } from '../storage-writer-ec9fd9e8.js';

var _=le$1;var T=function(e,t){return _(e,t)};async function M(e){return new Promise((t=>chrome.browserAction.setIcon(e,t)))}async function j(e){return new Promise((t=>chrome.browserAction.setBadgeText(e,t)))}async function q(e){return new Promise((t=>chrome.browserAction.setBadgeBackgroundColor(e,t)))}let V;async function F(e){T(V,e)||(V=e,await async function({icon:e,text:t,color:r}){await Promise.all([M({path:e}),j({text:t}),q({color:r})]);}(V));}var U={
/*!
 * cookie
 * Copyright(c) 2012-2014 Roman Shtylman
 * Copyright(c) 2015 Douglas Christopher Wilson
 * MIT Licensed
 */
parse:function(e,t){if("string"!=typeof e)throw new TypeError("argument str must be a string");var r={},o=(t||{}).decode||D,a=0;for(;a<e.length;){var n=e.indexOf("=",a);if(-1===n)break;var s=e.indexOf(";",a);if(-1===s)s=e.length;else if(s<n){a=e.lastIndexOf(";",n-1)+1;continue}var i=e.slice(a,n).trim();if(void 0===r[i]){var c=e.slice(n+1,s).trim();34===c.charCodeAt(0)&&(c=c.slice(1,-1)),r[i]=$(c,o);}a=s+1;}return r},serialize:function(e,t,r){var o=r||{},a=o.encode||W;if("function"!=typeof a)throw new TypeError("option encode is invalid");if(!B.test(e))throw new TypeError("argument name is invalid");var n=a(t);if(n&&!B.test(n))throw new TypeError("argument val is invalid");var s=e+"="+n;if(null!=o.maxAge){var i=o.maxAge-0;if(isNaN(i)||!isFinite(i))throw new TypeError("option maxAge is invalid");s+="; Max-Age="+Math.floor(i);}if(o.domain){if(!B.test(o.domain))throw new TypeError("option domain is invalid");s+="; Domain="+o.domain;}if(o.path){if(!B.test(o.path))throw new TypeError("option path is invalid");s+="; Path="+o.path;}if(o.expires){var c=o.expires;if(!function(e){return "[object Date]"===N.call(e)||e instanceof Date}(c)||isNaN(c.valueOf()))throw new TypeError("option expires is invalid");s+="; Expires="+c.toUTCString();}o.httpOnly&&(s+="; HttpOnly");o.secure&&(s+="; Secure");if(o.priority){switch("string"==typeof o.priority?o.priority.toLowerCase():o.priority){case"low":s+="; Priority=Low";break;case"medium":s+="; Priority=Medium";break;case"high":s+="; Priority=High";break;default:throw new TypeError("option priority is invalid")}}if(o.sameSite){switch("string"==typeof o.sameSite?o.sameSite.toLowerCase():o.sameSite){case!0:s+="; SameSite=Strict";break;case"lax":s+="; SameSite=Lax";break;case"strict":s+="; SameSite=Strict";break;case"none":s+="; SameSite=None";break;default:throw new TypeError("option sameSite is invalid")}}return s}},N=Object.prototype.toString,B=/^[\u0009\u0020-\u007e\u0080-\u00ff]+$/;function D(e){return -1!==e.indexOf("%")?decodeURIComponent(e):e}function W(e){return encodeURIComponent(e)}function $(e,t){try{return t(e)}catch(t){return e}}var z={exports:{}},G={decodeValues:!0,map:!1,silent:!1};function J(e){return "string"==typeof e&&!!e.trim()}function X(e,t){var r=e.split(";").filter(J),o=r.shift().split("="),a=o.shift(),n=o.join("=");t=t?Object.assign({},G,t):G;try{n=t.decodeValues?decodeURIComponent(n):n;}catch(e){console.error("set-cookie-parser encountered an error while decoding a cookie with value '"+n+"'. Set options.decodeValues to false to disable this feature.",e);}var s={name:a,value:n};return r.forEach((function(e){var t=e.split("="),r=t.shift().trimLeft().toLowerCase(),o=t.join("=");"expires"===r?s.expires=new Date(o):"max-age"===r?s.maxAge=parseInt(o,10):"secure"===r?s.secure=!0:"httponly"===r?s.httpOnly=!0:"samesite"===r?s.sameSite=o:s[r]=o;})),s}function Y(e,t){if(t=t?Object.assign({},G,t):G,!e)return t.map?{}:[];if(e.headers&&e.headers["set-cookie"])e=e.headers["set-cookie"];else if(e.headers){var r=e.headers[Object.keys(e.headers).find((function(e){return "set-cookie"===e.toLowerCase()}))];r||!e.headers.cookie||t.silent||console.warn("Warning: set-cookie-parser appears to have been called on a request object. It is designed to parse Set-Cookie headers from responses, not Cookie headers from requests. Set the option {silent: true} to suppress this warning."),e=r;}if(Array.isArray(e)||(e=[e]),(t=t?Object.assign({},G,t):G).map){return e.filter(J).reduce((function(e,r){var o=X(r,t);return e[o.name]=o,e}),{})}return e.filter(J).map((function(e){return X(e,t)}))}z.exports=Y;var K=z.exports.parse=Y;z.exports.parseString=X,z.exports.splitCookiesString=function(e){if(Array.isArray(e))return e;if("string"!=typeof e)return [];var t,r,o,a,n,s=[],i=0;function c(){for(;i<e.length&&/\s/.test(e.charAt(i));)i+=1;return i<e.length}for(;i<e.length;){for(t=i,n=!1;c();)if(","===(r=e.charAt(i))){for(o=i,i+=1,c(),a=i;i<e.length&&"="!==(r=e.charAt(i))&&";"!==r&&","!==r;)i+=1;i<e.length&&"="===e.charAt(i)?(n=!0,i=a,s.push(e.substring(t,o)),t=i):i=o+1;}else i+=1;(!n||i>=e.length)&&s.push(e.substring(t,e.length));}return s};const Q="toggle_pause",Z="switch_to_profile_1",ee="switch_to_profile_2",te="switch_to_profile_3",re="switch_to_profile_4";async function oe(e,t){t<e.profiles.length&&await on(t);}const ae=[3===chrome.runtime.getManifest().manifest_version?"action":"browser_action"],ne={};async function se(){await async function(){return new Promise((e=>chrome.contextMenus.removeAll(e)))}(),await async function(e){return new Promise((t=>chrome.contextMenus.create(e,t)))}({id:"pause",title:"Pause",contexts:ae});}async function ie(e,{title:t,onclick:r}){ne[e]!==t&&(ne[e]=t,await async function(e,t){return new Promise((r=>chrome.contextMenus.update(e,t,r)))}(e,{title:t,contexts:ae,onclick:r}));}async function ce(){let e,t=await Qt();if(!t.profiles){const r=await Wt(),o=r?Object.keys(r):[];o.sort(),o.length>0&&(t={profiles:r[o[o.length-1]],selectedProfile:0,savedToCloud:!0},e=!0);}return Ce$1(t.profiles)&&(t.profiles=[]),Sv(t.profiles)&&(e=!0),(Jf(t.selectedProfile)||t.selectedProfile<0||t.selectedProfile>=t.profiles.length)&&(t.selectedProfile=t.profiles.length-1,e=!0),e&&await Ut(t),t}function le(e){return !e.isPaused}function ue(e,t){return e.regexEnabled?Object.keys(t).filter((t=>new RegExp(e.name,"g").test(t))):t.hasOwnProperty(e.name)?[e.name]:[]}function fe({appendMode:e,originalValue:t,newValue:r}){switch(e){case fb.COMMA_SEPARATED_APPEND:return t?t+","+r:r;case fb.APPEND:return t+r;default:return r}}function de(e,t,r,o){if(!r||!r.length)return;const n={};for(let e=0;e<o.length;e++){n[o[e].name.toLowerCase()]=e;}for(const t of r){const r=t.name.toLowerCase(),s=n[r];if(!t.value&&void 0!==s&&!t.sendEmptyHeader){o[s].needRemoval=!0;continue}const i=mr({value:t.value,url:e,oldValue:void 0!==s?o[s].value:void 0});void 0!==s?o[s].value=fe({appendMode:t.appendMode,originalValue:o[s].value,newValue:i}):(o.push({name:t.name,value:i}),n[r]=o.length-1);}}function pe(e,t,r,o){if(!r||!r.length)return;const n=o.find((e=>"cookie"===e.name.toLowerCase())),s=U.parse(n?n.value:"");for(const t of r){const r=ue(t,s);0!==r.length||t.regexEnabled||(s[t.name]=mr({value:t.value,oldValue:"",url:e}));for(const o of r)t.value||!s.hasOwnProperty(o)||t.sendEmptyHeader?s[o]=mr({value:t.value,oldValue:s[o],url:e}):delete s[o];}const i=Object.entries(s).map((([e,t])=>`${e}=${encodeURIComponent(t)}`)).join("; ");if(n)n.value=i,i||(n.needRemoval=!0);else {const e={name:"cookie",value:i};i||(e.needRemoval=!0),o.push(e);}}function he(e,t,r,o){if(!r||!r.length)return;const n=[];let s={};for(let e=0;e<o.length;e++){const t=o[e];if("set-cookie"===t.name.toLowerCase()){const r=K(t.value);for(const e of r)s[e.name]=e;n.push(e);}}for(const t of r)if(t.value){const r=ue(t,s);if(0!==r.length||t.regexEnabled)for(const o of r){const r=mr({value:t.value,oldValue:s[o].value,url:e});t.attributeOverride?s[o]={...t,value:r}:s[o].value=r;}else s[t.name]={...t,value:mr({value:t.value,oldValue:"",url:e})};}else {const r=ue(t,s);if(r.length>0)for(const o of r)t.retainExistingCookie?s[o]={...t,value:mr({value:s[o].value,oldValue:s[o].value,url:e})}:s[o].value="";}n.reverse();for(const[e,t]of Object.entries(s)){const r=U.serialize(e,t.value,t);if(n.length>0){o[n.pop()].value=r;}else o.push({name:"set-cookie",value:r});}}function me(e,t,r,o){if(!r||!r.length)return;let a=-1;for(let e=0;e<o.length;e++){if("content-security-policy"===o[e].name.toLowerCase()){a=e;break}}let s={};for(const e of r)s[e.name]=e.value;const i=jr(s);a>=0?o[a].value=i:o.push({name:"content-security-policy",value:i});}var ge=function(e){return void 0===e};async function we(e){let r=await async function(){const[e,r]=await Promise.all([ce(),we$1()]);return r.length>0&&Sv(r),e.managedProfiles=r,e}(),o=ye(r);await e(o),tn((async t=>{const a=!ge(t.profiles);if(a){let e=t.profiles.newValue;if(ge(e)&&(e=[]),Sv(e))return void await en(e)}for(const[e,o]of Object.entries(t))r[e]=o.newValue;(a||t.selectedProfile)&&(o=ye(r)),await e(o),a&&await async function(e){const t=await Wt(),r=t?Object.keys(t):[];r.sort(),r.length>=20&&await Yt(r.slice(0,r.length-20));if(0===r.length||!T(t[r[r.length-1]],e.profiles)){const t={};t[Date.now()]=e.profiles,await Xt(t);}}(r);}));}function ve(e){const t=Eo(e);return t.headers=jv(t.headers),t.respHeaders=jv(t.respHeaders),t.cookieHeaders=jv(t.cookieHeaders),t.setCookieHeaders=jv(t.setCookieHeaders),t.cspHeaders=jv(t.cspHeaders),t.urlReplacements=wr(t.urlReplacements),t.urlFilters=ib(t.urlFilters),t.excludeUrlFilters=ib(t.excludeUrlFilters),t.resourceFilters=cb(t.resourceFilters),t.tabFilters=ub(t.tabFilters),t.tabGroupFilters=ub(t.tabGroupFilters),t.windowFilters=ub(t.windowFilters),t.timeFilters=ub(t.timeFilters),t}function ye(e){const t=[];let r;if(e.managedProfiles.length>0)for(const r of e.managedProfiles){const e=ve(r);t.push(e);}if(e.profiles){const o=e.profiles;for(const[a,n]of o.entries()){if(a!==e.selectedProfile&&!n.alwaysOn)continue;const o=ve(n);a===e.selectedProfile&&(r=o),t.push(o);}}return {chromeLocal:e,activeProfiles:t,selectedActiveProfile:r}}const be="EXISTS",Pe="IMPORT",ke="IMPORT_AUTO_SYNC",xe="SWITCH_TO_LATEST",He="PROFILES";const Se={};function Le(e,t){Se[e]||chrome.webRequest[e].addListener(t.callback,t.filter,t.extraInfoSpec);}function Ae(e,t){Se[e]&&chrome.webRequest[e].removeListener(t);}Ob();const Ce=["<all_urls>"];let Re,Oe={isPaused:!0},Ee=[];function Ie(e){return function({chromeLocal:e,activeProfiles:t,details:r}){if(le(e)){let e=r.url;for(const a of t)sb({url:e,type:r.type,tabId:r.tabId,profile:a})&&(e=_r({urlRedirects:a.urlReplacements,url:e}));if(e!==r.url)return {redirectUrl:e}}}({chromeLocal:Oe,activeProfiles:Ee,details:e})}function _e(e){return function({chromeLocal:e,activeProfiles:t,details:r}){if(le(e)&&t.length>0){for(const e of t)sb({url:r.url,type:r.type,tabId:r.tabId,profile:e})&&(de(r.url,0,e.headers,r.requestHeaders),pe(r.url,0,e.cookieHeaders,r.requestHeaders),r.requestHeaders=r.requestHeaders.filter((e=>!e.needRemoval)));return {requestHeaders:r.requestHeaders}}}({chromeLocal:Oe,activeProfiles:Ee,details:e})}function Te(e){return function({chromeLocal:e,activeProfiles:t,details:r}){if(le(e)&&t.length>0){const e=r.responseHeaders||[];let o;for(const a of t)sb({url:r.url,type:r.type,tabId:r.tabId,profile:a})&&(o||(o=Eo(e)),de(r.url,0,a.respHeaders,o),he(r.url,0,a.setCookieHeaders,o),me(r.url,0,a.cspHeaders,o),o=o.filter((e=>!e.needRemoval)));if(o&&!T(o,e))return {responseHeaders:o}}}({chromeLocal:Oe,activeProfiles:Ee,details:e})}function Me(e){if(e.url.includes("//webdriver.modheader.com/")||e.url.includes("//webdriver.bewisse.com/")||e.url.includes("//bewisse.com/")){const t=new URL(e.url);if("/add"===t.pathname||"/clear"===t.pathname||"/load"===t.pathname)return chrome.tabs.update(null,{url:chrome.runtime.getURL(t.pathname+".html"+t.search)}),{cancel:!0}}}function je(){Ee.find((e=>e.urlReplacements.length>0))?Le("onBeforeRequest",{callback:Ie,filter:{urls:Ce},extraInfoSpec:["blocking"]}):function(e){Ae("onBeforeRequest",e);}(Ie),Ee.find((e=>e.headers.length>0||e.cookieHeaders.length>0))?function(e,t){Le("onBeforeSendHeaders",{callback:e,filter:{urls:t},extraInfoSpec:["requestHeaders","blocking","extraHeaders"]});}(_e,Ce):function(e){Ae("onBeforeSendHeaders",e);}(_e),Ee.find((e=>e.respHeaders.length>0||e.setCookieHeaders.length>0||e.cspHeaders.length>0))?function(e,t){Le("onHeadersReceived",{callback:e,filter:{urls:t},extraInfoSpec:["responseHeaders","blocking","extraHeaders"]});}(Te,Ce):function(e){Ae("onHeadersReceived",e);}(Te);}async function qe(e,t){const r=await async function({chromeLocal:e,request:t}){switch(console.log("Received message",t),t.type){case be:{const e=chrome.runtime.getManifest();return {success:!0,maxSupportedProfileVersion:bb,canImportWithAutoSync:!0,modHeaderVersion:e.version}}case Pe:{const r=[JSON.parse(t.profile)];Sv(r);const o=[...e.profiles,...r];return await nn(o,o.length-1),{success:!0}}case ke:{const r=await Oe$1({liveProfileUrl:t.profileUrl}),o=[...e.profiles,r];return await nn(o,o.length-1),{success:!0}}case xe:return await on(e.profiles.length-1),{success:!0};case He:return {success:!0,profiles:e.profiles,selectedProfileIndex:e.selectedProfile,managedProfiles:e.managedProfiles};default:return}}({chromeLocal:Oe,request:e});r&&t(r);}chrome.runtime.onMessageExternal.addListener((async(e,t,r)=>{!t.origin||t.origin.startsWith("https://modheader.com")?await qe(e,r):r({error:"Unsupported origin"});})),chrome.commands.onCommand.addListener((async e=>{await async function(e,t){switch(t){case Q:await rn(!e.isPaused);break;case Z:await oe(e,0);break;case ee:await oe(e,1);break;case te:await oe(e,2);break;case re:await oe(e,3);}}(Oe,e);})),chrome.alarms.onAlarm.addListener((async e=>{"checkLiveProfileAlarm"===e.name&&!Oe.isPaused&&Oe.profiles&&await Pe$1(Oe.profiles);})),window.saveToStorage=function(e){return Ut(e)},async function(){await dl(),await se(),await we((async e=>{Oe=e.chromeLocal,Ee=e.activeProfiles,Re=e.selectedActiveProfile,je(),await async function({chromeLocal:e,activeProfiles:t,selectedActiveProfile:r}){if(e.isPaused)await F({icon:"images/icon_bw.png",text:"❚❚",color:"#666"});else {let e=0;for(const r of t)e+=r.headers.length+r.respHeaders.length+r.cookieHeaders.length+r.setCookieHeaders.length+r.cspHeaders.length+r.urlReplacements.length;0===e?await F({icon:"images/icon_bw.png",text:"",color:"#fff"}):await F({icon:"images/icon.png",text:e.toString(),color:r.backgroundColor});}}({chromeLocal:Oe,activeProfiles:Ee,selectedActiveProfile:Re}),await async function(e){e.isPaused?await ie("pause",{title:"Unpause ModHeader",onclick:()=>rn(!1)}):await ie("pause",{title:"Pause ModHeader",onclick:()=>rn(!0)});}(Oe);})),chrome.webRequest.onBeforeRequest.addListener(Me,{urls:["<all_urls>"]},["blocking"]),chrome.alarms.create("checkLiveProfileAlarm",{periodInMinutes:30,when:1});}(),chrome.runtime.onInstalled.addListener((e=>{e.reason;}));
